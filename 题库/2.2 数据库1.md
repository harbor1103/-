# 数据库1

## 超牛逼参考文章

[三天吃透MySQL面试八股文 - 哔哩哔哩 (bilibili.com)](https://www.bilibili.com/read/cv22384534)





### 1——怎么把MySql运用到你的项目里面：

我们的登录注册功能使用mysql用来存储用户的用户名，密码，盐值，还有其token

------

### 2——MySql内联和外联的区别 

内连接：**inner_join** ,首先当内连接不加**on**的时候与交叉连接的效果相同。

on子句是用来设定连接条件的。

**就是利用条件[表达式](https://so.csdn.net/so/search?q=表达式&spm=1001.2101.3001.7020)来消除交叉连接的某些数据行。**

**外连接：分为左外连接left join和右外连接right join**

**外连接更加注重两张表之间的关系**

左外连接：	当右表中没有与之对应的记录时，查询出的右表中的数据全部用NULL代替，左表中的所有数据都出现

(意思就是:**当内连接时，数据相当才会出现，而在外连接中，数据相等左右表都出现，其他情况，左表出现，右表为NULL)**

------

### 3——Mysql如何实现两张表的关联

可以在一张表A设置主键，在另一张表B设置外键关联于表A的主键

------

### 4——Mysql如何合并两张表

**mysql的union用于将多个select语句的结果组合成一个结果集，即把多个查询的结果合并成一个结果集。**



**这里补充一下union和join的区别**

![1678765093136](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\1678765093136.png)



------

### 5——inner_join和left_join的区别？数据是什么样的时候搜索结果会有差异?

inner_join和left_join的区别在于，inner_join会返回两个表中共有的行，而left__join如果在右表中没有找到结果，也会打印右表只不过数据都为NULL。



数据的差异取决于右表中是否存在没有与左表匹配的行

------

### 6——mysql如何合并两个表

union

------

### 7——如何通过一个表，检索到另一张表

在mysql中可以使用inner_join,left_join或者right_join来连接到另一张表

------

### 8——如何优化查询语句?怎么判断这个查询是否是高效率的?

1.使用正确的索引，并且正确的使用索引

2.使用正确的数据类型

3.使用explain语句还检查查询计划。type尽量做到在range以上

4.使用慢查询来监视哪些查询速度慢

5.避免回表



（2）使用explain命令来查看查询的性能情况



------

### 9——inner,left,right的区别

左外连接：	当右表中没有与之对应的记录时，查询出的右表中的数据全部用NULL代替，左表中的所有数据都出现



### 10——当你上传文件或更改文件时，如果出问题中断了，会不会导致数据库和文件对不上，怎么解决的?

------

1.可以使用版本控制系统，查看并且恢复到之前的版本（事务中的savepoint 和rollback）

2.经常备份数据，以防出现问题

### 11——mysql用的什么引擎？ 那两种引擎有什么区别？

------

|        |                |            |                          |          |            |                |            |
| ------ | -------------- | ---------- | ------------------------ | -------- | ---------- | -------------- | ---------- |
| MyISAM | 支持表锁       | 不支持事务 | 三个文(.frm .myd .myi)件 | 不支持   | 非聚集索引 | 不支持Hash索引 | 不支持外键 |
| InnoDB | 支持表锁和行锁 | 支持事务   | 两个文件                 | 支持MVCC | 聚集索引   | 支持Hash索引   | 支持外键   |

memory：数据全部放在内存里，默认使用hash索引

优点:访问速度快

缺点：无法排序，无法范围查找，哈希冲突时需要遍历链表所有的行指针





### 12——数据库索引，索引怎么用，适合什么场景，什么时候索引失效?

------

```
索引怎么用：**

1.索引可以在创建表时指定，也可以在表创建后添加。
```



```
适合什么场景：**

1.大量数据查询

2.更新操作

3.快速排序
```

```
*什么时候索引失效**

1.在索引处使用函数或者算式

2.误用不等号

3.NULL/NOT NULL

4.误用 select * 

5.在字符串查找时 没有用 引号

6.用union不要用or

7.存储引擎中不能使用索引中范围条件右边的列
```





### 13——数据库事务是什么，事务的隔离级别有多少种，分别是什么？

------

事务：一个命令操作是原子级别的，不可再分割的一组命令集合

隔离级别有四种

1.读未提交：可以避免脏写，剩下的不可以避免

2.读已提交：可以避免脏写，脏读

3.可重复读：可以避免脏写，脏读，不可重复读

4.串行化：相当于只允许单线程操作，全都避免调



### 14——数据库查询可以怎么优化？

------

1.尽量使用索引

2.尽量不要使用回表，避免全表扫描

3.explai的type在range以上



### 15——数据库隔离级别

------





### 16——不可重复读和幻读区别是什么？脏读是什么？可以举个例子吗

------

不可重复读：T1读，T2update数据，T1读发现数据变了

幻读：T1读，T2insert数据，T1发现数据多了

脏读是：T1在写还未提交，T2也写并且提交，此时T1可能还会再写，但数据已经变化了，提交的就是错误数据



### 17——在幻读这里有个概念是当前读和幻读

------

幻读是一种技术，它可以让计算机以不同的方式理解和处理数据。

当前读：是mysql的一种操作类型，它的作用是从一个已经打开的表中读取数据。它会从当前行开始检索，并在每次调用时，返回下一行的内容。

### 18——什么是聚合索引 ？什么是非聚合索引

------

聚合索引：按照每张表的主键构建一颗B+树，同时叶子结点存放的是整张表的行数据

非聚合索引：指一个索引只包含单个字段，用于提高查询效率



### 19——为什么MySQL索引要使用B+树，而不是B树或者红黑树？

------

因为B树的每个结点都存放数据，当数据多了之后，树高一高会占据很多的存储空间，虽然B+树把结点都存在了叶子节点，但是因为其非叶子结点只存索引和指针，反而比B树更加节省空间。

B+树的空间复杂度比B树和红黑树低，节约磁盘空间

B+树在搜索数据时只需要访问一次索引，而B树和红黑树需要多次访问索引。



### 20——你知道哪些数据库结构优化的手段

------

1使用范式原则

1.每个列保持原子

2.每个列和主键是相关

3.每个列和主键是直接相关，而不是间接相关



1.合理划分表空间，设计表结构

2.优化查询语句

3.合理的设计索引

4.定期explain



### 21——monoDB?

------

开源的NoSQl数据库

json-like文档作为存储数据模型



### 22——B树和B+树区别

------

| B树                        | B+树                                                         |
| -------------------------- | ------------------------------------------------------------ |
| 所有叶子节点在同一层       | 所有叶子节点在同一层，并且在叶子之间建立了指针相互连接，形成了一个有序链表 |
| 所有结点偶读包含关键字信息 | 非叶子结点是索引结点，不包含关键字信息                       |
| 可以查找插入删除           | 只能查找和插入                                               |
|                            |                                                              |
|                            |                                                              |

待补充

### 23——mysql用的什么引擎？

------

InnoDB

### 24——普通索引跟唯一索引在写入性能上有没有什么差异

------

差异较小。

但是如果写入数据时需要检查唯一索引，则需要做更多的检查操作，使得唯一索引的写入性能更差。

### 25——英语成绩降序查找

答：select * from table order by 列名 desc

------

### 26——约束

答：主键约束(primary key) PK

自增长约束（auto_increment）

非空约束(not null)

唯一性约束(unique)

默认约束（default）

零填充约束（zerofill）

外键约束（foreign key） FK

------

### 27——什么是Mysql

Mysq是关系型数据库

采用表的形式存储数据，可以理解为Excel表格

------

### 28——事物的四大特性

A：atomic-原子性：事物的操作是一个整体，要么都做，要么都不做

C：consistency-一致性：修改数据前后，数据总和保持不变

I：isolation-隔离性：事物之间不能相互交叉(跟隔离级别有关)

D：durability-持久性：数据一旦被修改是永久性的

------

### 29——生产环节数据库一般用的什么隔离级别？

答：**一般用RC，read Commiteed 读已提交**

为什么不是RR(可重复读 Repeatable Read)

原因一：大部分场景下，不可重复读问题是可以接受的，毕竟数据都已经提交了。

原因二：RR隔离级别下，条件列未命中索引会锁表！而RC隔离级别下只锁行

------

### 30——什么是索引？

索引是存储引擎用于提高数据库表的访问速度的一种数据结构。

相当于目录

------

### 31——索引优缺点

优点：快速找到查询数据

缺点：需要占用物理空间，需要动态维护索引

------

### 32——Hash索引和B+树索引

Hash不支持排序

Hash不支持范围查找

Hash不支持模糊查询和最左前缀匹配

Hash会存在哈希冲突

------

### 33——索引有什么分类

1.主键索引

2.组合索引：需遵循最左前缀原则。 

3.唯一索引

4.全文索引

5.普通索引

------

### 34——什么是最左匹配原则？ 

举个例子：最左匹配原则是组合索引里需要用到的，

(a,b,c)组合索引

查(a)(a,b)(a,b,c)(a,c)会走(a,b,c)组合索引

查（b）（c）（b，c）（c，b）不会走到组合索引

### 35——什么是聚集索引？

索引和数据放在一起

------



### 36——什么是覆盖索引？

只需要查索引就能得到数据，查询列被所使用的索引覆盖，不需要回表

------

### 37——Mysql有哪些锁

```
按粒度分：

行级锁：

表级锁：

页级锁：
```

```
按锁级别分

共享锁:读锁，其他用户可以读，所有用户都不许写

排他锁：写锁

还有一个意向锁(没了解过)
```



------

### 38——快照读和当前读

表记录有两种读取方式。

快照读：读取的是快照版本。普通的SELECT就是快照读。通过mvcc来进行并发控制的，不用加锁。

当前读：读取的是最新版本。UPDATE、DELETE、INSERT、SELECT … LOCK IN SHARE MODE、SELECT … FOR 

UPDATE是当前读。 

那么MySQL是如何避免幻读？

在快照读情况下，MySQL通过mvcc来避免幻读。

在当前读情况下，MySQL通过next-key来避免幻读（加行锁和间隙锁来实现的）。

next-key包括两部分：行锁和间隙锁。行锁是加在索引上的锁，间隙锁是加在索引之间的。

Serializable隔离级别也可以避免幻读，会锁住整张表，并发性极低，一般不会使用。



### 39——讲一下MYsql架构

MySQL可以分为 **Server层**和**存储引擎层**。 Server 层包括连接器、查询缓存、解析器、优化器和执行器等，涵盖了 MySQL 大多数核心服务功能。

存储引擎层负责数据的**存储**和**提取**。其架构模式是**插件式**的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。

------

### 40——truncate，delete与drop的区别

drop：删除表结构，和表数据

delete：加了条件删除一行，不加条件删除表数据

truncate：先删除数据和结构，再复制一份结构

------

### 41——为什么主从同步？

1.读写分离，使数据库能支撑更大的并发。

2.数据备份

3，主服务器生成实时数据，从服务器分析这些数据，提高主服务器性能

------

### 42——什么是MySQL主从同步？ 

可以使数据从一个数据库服务器(master)复制到另一个数据库服务器(slave)

------

### 43——乐观锁和悲观锁

锁是并发控制的一种手段，为了确保多事务同时进行数据不被破坏

悲观锁：假定数据发生冲突，会对操作的数据加锁，只有到提交事务之后，才会释放锁

乐观锁：假定数据不发生冲突，在提交操作时检查数据是否被修改过。乐观锁一般使用版本号机制或cas算法

------

### 44——说说count(1)、count(*)和count(字段名)的区别 

count(*)包括了所有的列，相当于行数，在统计结果的时候，包括NULL

count(1)包括了忽略所有列，用1代表代码行，在统计结果的时候包括NULL

count(字段名)只包括列名那一列，在统计结果的时候，不包括NULL

------

### 45——MySQL中DATETIME 和 TIMESTAMP有什么区别？ 

TIMESTAMP和DATETIME都可以用来存储时间

(不做相信介绍)

46

47

48

49

50