## 4.进程管理（星空）

### 1.进程间的通信方式

管道：有名管道，无名管道

消息队列

信号量

共享内存

套接字







### 2.进程同步的方式





互斥锁mutex

信号量

条件变量 condition

消息传递



### 3.有哪些锁

互斥锁

读写锁

条件变量

自旋锁



### 4.socket进行传输的时候发生了几次拷贝(这个问题答案存疑)

2次，磁盘文件到内核态的文件缓冲区，然后到用户态，用户态再到内核态的socket缓冲区，然后再到磁盘。

socket传输的时候，实际发生了两次拷贝，第一次使将要传输的数据从用户空间拷贝到内核空间。

第二次是从源主机拷贝到目标主机



零拷贝看这个网址：

<https://zhuanlan.zhihu.com/p/467302001>



### 6.讲一下管道

有名管道、匿名管道，对亲缘关系的依赖程度，看笔记，很清晰

管道-实现进程间通信

有名管道(FIFO)，通过内核的管道缓冲区（没有经过磁盘），进程间传递数据

匿名管道：对于拥有亲缘关系的两个进程而言，他们之间可以使用另一种管道，这个管道可以随着进程的退出而自动销毁





### 7.线程通信

多个线程是共享一片地址空间的，所以各个线程可以并发的访问同一个数据段/堆空间和其他位置

共享内核态大部分内容和堆空间，通过读取共享空间中的数据实现通信



### 8.线程安全/同步/互斥等等（重中之重）



互斥锁和条件变量，讲概念

**同步互斥**

多线程之间共享同一个地址空间，且多线程之间不存在隔离。

在并发执行情况下，大量的共享资源成为竞争条件。各线程对共享资源随意修改，导致数据出现错误。

所以要引入互斥锁mutex，锁分为加锁解锁.

一个线程加了锁，其他线程在读取数据时，会阻塞等待，直到锁被释放(也就是解锁)。

这里面还有一个**条件变量**的引入，当资源有限，并且资源会被存也会被取的时候，条件变量是一种分配方式，条件变量必须配合锁来使用

**线程安全：**

由于各线程共享一片地址空间，有的时候有些库函数不是线程安全





### 9如何防止死锁

不要写+用cleanup_push&cleanup_pop注册unlock

1.尽量不使用嵌套所

2.对于任何一个锁，使用相同的顺序获得和释放

3.用超时机制来避免进程永久等待下去



### 10介绍一下项目当中如何运用epoll，以及epoll是干什么用的

epoll是一种IO多路复用机制，可以监听多个设备的就绪状态，让进程或者线程只有在事件发生后在执行真正的读写操作。

epoll在内核态空间中维持两个数据结构：**监听事件集合**(红黑树)，**就绪事件队列**(线性表)

**监听事件集合**用来存储所有需要关注的设备（文件描述符）和对应操作(比如读，写，挂起异常等) 

当监听的设备有事件产生时，比如网卡上接受到了数据并传输到了缓冲区当中，

硬件会采用中断等方式通知操作系统，操作系统会将就绪事件拷贝到**就绪事件队列中**

并且找到阻塞在epoll_wait的线程，让其就绪。







### 11进程和线程的区别是什么？

| 进程                             | 线程                           |
| -------------------------------- | ------------------------------ |
| 分配资源，资源分配的基本单位     |                                |
| **进程拥有独立的地址空间**       | **线程是共享父进程的地址空间** |
|                                  | 线程是进程生下来的             |
| 进程之间的创建、撤销、切换开销大 | 线程小                         |

二者最大的区别就是能不能共享数据。

进程与进程间**不可以共享一片地址空间**，但是可以通信

线程与线程之间可以**共享父进程的地址空间**